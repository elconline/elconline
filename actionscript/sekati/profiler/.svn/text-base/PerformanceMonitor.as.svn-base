/** * sekati.profiler.PerformanceMonitor * @version 1.1.0 * @author jason m horwitz | sekati.com * Copyright (C) 2008  jason m horwitz, Sekat LLC. All Rights Reserved. * Released under the MIT License: http://www.opensource.org/licenses/mit-license.php *  * Initial concept adapted from hellokeita */package sekati.profiler {	import flash.display.*;	import flash.events.*;	import flash.system.System;	import flash.text.*;	import flash.utils.*;	import sekati.math.MathBase;		/**	 * PerformanceMonitor provides a visual reference to FPS and RAM usage.	 */	public class PerformanceMonitor {		private static var instance : PerformanceMonitor;		protected var time : Number = 0;		protected var maxMem : Number = 0;		protected var maxFps : int = 0;		protected var stage : Stage;		protected var tf : TextField;		protected var performanceUI : Sprite;		protected static const BAR_ALPHA : Number = 0.5;		protected static const BAR_HEIGHT : int = 12;		protected static const BAR_MULTIPLIER : int = 10;		protected static const MAX_MEM_COLOR : uint = 0x00FFFF;		protected static const MEM_COLOR : uint = 0xFFFF00;		protected static const FPS_COLOR : uint = 0xFF00FF;		/**		 * PerformanceMonitor Constructor		 */		public function PerformanceMonitor(s : Stage) {			if(instance) return;			stage = s;			instance = this;			init( );		}		/**		 * Initialize the UI		 */		protected function init() : void {			tf = new TextField( );			tf.autoSize = TextFieldAutoSize.LEFT;			tf.blendMode = BlendMode.INVERT;			var textFormat : TextFormat = new TextFormat( );			textFormat.font = "Verdana";			textFormat.size = 9;			textFormat.leading = 1;			textFormat.letterSpacing = -0.7;			tf.defaultTextFormat = textFormat;			tf.autoSize = TextFieldAutoSize.LEFT;						performanceUI = new Sprite( );			performanceUI.addChild( tf );			stage.addChild( performanceUI );			stage.addEventListener( Event.ENTER_FRAME, update, false, 0, true );		}		/**		 * Update performance info.		 */		protected function update(e : Event = null) : void {			var t : int = getTimer( );			var fps : int = Math.round( 1000 / (t - time) );			var mem : Number = MathBase.round( System.totalMemory / (1024 * 1024), 2 );			time = t;			var memStr : String = "RAM: " + mem + " MB (" + Math.round( mem * 1024 ) + " kb)";			var maxMemStr : String = " / " + maxMem + " MB (" + Math.round( maxMem * 1024 ) + " kb)";			var fpsStr : String = "\nFPS: " + fps + " / " + maxFps;			tf.text = memStr + maxMemStr + fpsStr;			performanceUI.graphics.clear( );			performanceUI.graphics.beginFill( MAX_MEM_COLOR, BAR_ALPHA );			performanceUI.graphics.drawRect( 0, 2, (maxMem * BAR_MULTIPLIER), BAR_HEIGHT );			performanceUI.graphics.beginFill( MEM_COLOR, (BAR_ALPHA + 0.3) );			performanceUI.graphics.drawRect( 0, 2, (mem * BAR_MULTIPLIER), BAR_HEIGHT );			performanceUI.graphics.beginFill( FPS_COLOR, BAR_ALPHA );			performanceUI.graphics.drawRect( 0, 14, (fps * BAR_MULTIPLIER), BAR_HEIGHT );						if(mem > maxMem) maxMem = mem;			mem = NaN;						if(fps > maxFps) maxFps = fps;			fps = NaN;						stage.setChildIndex( performanceUI, stage.numChildren - 1 );		}	}}